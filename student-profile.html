<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        .info-grid p {
            margin: 0;
            font-size: 14px;
            color: #4b5563;
        }
        .info-grid p strong {
            color: #1f2937;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }
        th {
            background-color: #f9fafb;
            font-weight: 500;
            color: #4b5563;
        }
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
            table th, table td {
                font-size: 12px;
                padding: 6px 8px;
            }
        }
        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }
            .info-grid p {
                font-size: 12px;
            }
            table th, table td {
                font-size: 11px;
                padding: 4px 6px;
            }
            #gpaChart {
                height: 120px !important;
            }
        }
    </style>
</head>
<body class="bg-[#f5f5f5]">
    <div class="container">
        <!-- Header Section -->
        <div class="section">
            <div class="flex items-center">
                <img src="https://github.com/avashx/nsutgod/blob/main/src/logo.png?raw=true" alt="NSUTGod Logo" class="h-16 w-16 mr-4">
                <div>
                    <h2 class="text-xl font-bold" id="studentName"></h2>
                    <p class="text-sm text-gray-600" id="studentHandle"></p>
                </div>
            </div>
        </div>

        <!-- Personal Information Section -->
        <div class="section">
            <h3 class="section-title">Personal Information</h3>
            <div class="info-grid">
                <p><strong>Roll Number:</strong> <span id="rollNumber"></span></p>
                <p><strong>Email:</strong> <span id="email"></span></p>
                <p><strong>Personal Email:</strong> <span id="personalEmail"></span></p>
                <p><strong>Gender:</strong> <span id="gender"></span></p>
                <p><strong>Date of Birth:</strong> <span id="dob"></span></p>
                <p><strong>Contact Number:</strong> <span id="contactNumber"></span></p>
                <p><strong>Alternate Contact Number:</strong> <span id="altContactNumber"></span></p>
                <p><strong>Present Address:</strong> <span id="presentAddress"></span></p>
                <p><strong>Permanent Address:</strong> <span id="permAddress"></span></p>
                <p><strong>Category:</strong> <span id="category"></span></p>
                <p><strong>Campus:</strong> <span id="campus"></span></p>
                <p><strong>PWD:</strong> <span id="pwd"></span></p>
                <p><strong>Blood Group:</strong> <span id="bloodGroup"></span></p>
            </div>
        </div>

        <!-- Academic Information Section -->
        <div class="section">
            <h3 class="section-title">Academic Information</h3>
            <div class="info-grid">
                <p><strong>Branch:</strong> <span id="branch"></span></p>
                <p><strong>Batch:</strong> <span id="batch"></span></p>
                <p><strong>Degree:</strong> <span id="degree"></span></p>
                <p><strong>CGPA 10th:</strong> <span id="cgpa10th"></span></p>
                <p><strong>CGPA 12th:</strong> <span id="cgpa12th"></span></p>
                <p><strong>CGPA:</strong> <span id="cgpa"></span></p>
                <p><strong>CGPA Before Drop:</strong> <span id="cgpaBeforeDrop"></span></p>
                <p><strong>Graduation GPA:</strong> <span id="graduationGpa"></span></p>
                <p><strong>Backlogs:</strong> <span id="backlogs"></span></p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Semester</th>
                        <th>GPA</th>
                    </tr>
                </thead>
                <tbody id="gpaTable">
                    <tr><td>Semester 1</td><td id="sem1Gpa"></td></tr>
                    <tr><td>Semester 2</td><td id="sem2Gpa"></td></tr>
                    <tr><td>Semester 3</td><td id="sem3Gpa"></td></tr>
                    <tr><td>Semester 4</td><td id="sem4Gpa"></td></tr>
                    <tr><td>Semester 5</td><td id="sem5Gpa"></td></tr>
                    <tr><td>Semester 6</td><td id="sem6Gpa"></td></tr>
                </tbody>
            </table>
        </div>

        <!-- GPA Graph Section -->
        <div class="section">
            <h3 class="section-title">Semester GPA Graph</h3>
            <canvas id="gpaChart" height="150"></canvas>
        </div>
    </div>

    <script src="session.js"></script>
    <script>
        // Check session on page load
        checkSession();

        // Get student data from URL
        const params = new URLSearchParams(window.location.search);
        const student = JSON.parse(decodeURIComponent(params.get('data')));

        // Populate student data
        document.getElementById('studentName').textContent = student.Name || '-';
        document.getElementById('studentHandle').textContent = `@${student.rollNumber || '-'}`;
        document.getElementById('rollNumber').textContent = student.rollNumber || '-';
        document.getElementById('email').textContent = student.email || '-';
        document.getElementById('personalEmail').textContent = student.personal_email || '-';
        document.getElementById('gender').textContent = student.gender || '-';
        document.getElementById('dob').textContent = student.dob || '-';
        document.getElementById('contactNumber').textContent = student.contact_number || '-';
        document.getElementById('altContactNumber').textContent = student.alt_contact_number || '-';
        document.getElementById('presentAddress').textContent = student.present_address || '-';
        document.getElementById('permAddress').textContent = student.perm_address || '-';
        document.getElementById('category').textContent = student.category || '-';
        document.getElementById('campus').textContent = student.campus || '-';
        document.getElementById('pwd').textContent = student.pwd || '-';
        document.getElementById('bloodGroup').textContent = student.blood_group || '-';
        document.getElementById('branch').textContent = student.branch || '-';
        document.getElementById('batch').textContent = student.batch || '-';
        document.getElementById('degree').textContent = student.degree || '-';
        document.getElementById('cgpa10th').textContent = student.cgpa_10th || '-';
        document.getElementById('cgpa12th').textContent = student.cgpa_12th || '-';
        document.getElementById('cgpa').textContent = student.cgpa || '-';
        document.getElementById('cgpaBeforeDrop').textContent = student.cgpa_before_drop || '-';
        document.getElementById('graduationGpa').textContent = student.graduation_gpa || '-';
        document.getElementById('backlogs').textContent = student.backlogs || '-';
        document.getElementById('sem1Gpa').textContent = student.sem1_gpa || '-';
        document.getElementById('sem2Gpa').textContent = student.sem2_gpa || '-';
        document.getElementById('sem3Gpa').textContent = student.sem3_gpa || '-';
        document.getElementById('sem4Gpa').textContent = student.sem4_gpa || '-';
        document.getElementById('sem5Gpa').textContent = student.sem5_gpa || '-';
        document.getElementById('sem6Gpa').textContent = student.sem6_gpa || '-';

        // GPA Graph with CGPA and CGPA Before Drop lines
        const ctx = document.getElementById('gpaChart').getContext('2d');
        const cgpa = parseFloat(student.cgpa) || 0;
        const cgpaBeforeDrop = parseFloat(student.cgpa_before_drop) || 0;
        const gpaData = [
            parseFloat(student.sem1_gpa) || 0,
            parseFloat(student.sem2_gpa) || 0,
            parseFloat(student.sem3_gpa) || 0,
            parseFloat(student.sem4_gpa) || 0,
            parseFloat(student.sem5_gpa) || 0,
            parseFloat(student.sem6_gpa) || 0
        ];

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6'],
                datasets: [
                    {
                        label: 'GPA',
                        data: gpaData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'CGPA',
                        data: Array(6).fill(cgpa),
                        borderColor: '#ef4444',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    },
                    {
                        label: 'CGPA Before Drop',
                        data: Array(6).fill(cgpaBeforeDrop),
                        borderColor: '#10b981',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }
                ]
            },
            options: {
                scales: {
                    y: { beginAtZero: true, max: 10 }
                }
            }
        });
    </script>
</body>
</html>
