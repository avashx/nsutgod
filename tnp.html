<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        .main-content {
            padding: 1.5rem;
            background-color: #f5f5f5;
        }
        .company-table-container {
            background-color: #fff;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-top: 16px;
        }
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .company-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 2000px; /* Ensure table is wide enough for all columns */
        }
        .company-table th {
            padding: 4px 8px;
            text-align: left;
            border-bottom: 2px solid #e5e7eb;
            font-size: 13px;
            font-weight: 500;
            color: #4b5563;
            background-color: #fafafa;
            position: relative;
            cursor: pointer;
            white-space: nowrap;
        }
        .company-table th:hover {
            background-color: #f5f5f5;
        }
        .company-table th .resize-handle {
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            cursor: col-resize;
            background-color: transparent;
        }
        .company-table th .resize-handle:hover {
            background-color: #d1d5db;
        }
        .company-table td {
            padding: 4px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .company-table .sort-icon {
            display: inline-block;
            margin-left: 4px;
            font-size: 12px;
        }
        .tag {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .action-btn {
            padding: 6px 12px;
            background-color: #2563eb;
            color: #fff;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        .action-btn:hover {
            background-color: #1e40af;
        }
        .network-log {
            margin-top: 16px;
            background-color: #fff;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 11px;
            color: #1f2937;
            line-height: 1.5;
        }
        .network-log .status {
            color: #dc2626;
            font-weight: 500;
        }
        .network-log .time {
            color: #16a34a;
            font-weight: 500;
        }
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            .company-table th, .company-table td {
                font-size: 12px;
            }
            .action-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
            .network-log {
                font-size: 10px;
            }
        }
        @media (max-width: 480px) {
            .main-content {
                padding: 0.75rem;
            }
            .company-table th, .company-table td {
                font-size: 11px;
            }
            .action-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
            .filter-group {
                flex-direction: column;
                gap: 8px;
            }
            .filter-group div {
                width: 100%;
            }
            .filter-group input,
            .filter-group select {
                width: 100%;
            }
            .network-log {
                font-size: 9px;
            }
        }
    </style>
</head>
<body class="bg-[#f5f5f5]">
    <!-- Main Content -->
    <div class="main-content">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Company</h1>
            </div>

            <!-- Fetch Options and Filters -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                <div class="flex space-x-2">
                    <button id="fetch-companies" class="action-btn">Fetch Companies</button>
                    <select id="fetch-limit" class="border border-gray-300 rounded px-2 py-1 text-sm">
                        <option value="all">Fetch All</option>
                        <option value="100">Fetch 100</option>
                        <option value="150">Fetch 150</option>
                        <option value="200">Fetch 200</option>
                        <option value="500">Fetch 500</option>
                    </select>
                    <button id="export-csv" class="action-btn hidden">Export to CSV</button>
                </div>
                <div class="flex flex-wrap gap-2 filter-group">
                    <div>
                        <label for="year-filter" class="text-sm text-gray-600 mr-2">Year:</label>
                        <select id="year-filter" class="border border-gray-300 rounded px-2 py-1 text-sm">
                            <option value="">All</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div>
                        <label for="type-filter" class="text-sm text-gray-600 mr-2">Type:</label>
                        <input id="type-filter" type="text" class="border border-gray-300 rounded px-2 py-1 text-sm">
                    </div>
                    <div>
                        <label for="cgpa-filter" class="text-sm text-gray-600 mr-2">CGPA:</label>
                        <input id="cgpa-filter" type="number" step="0.1" class="border border-gray-300 rounded px-2 py-1 text-sm w-16">
                    </div>
                    <div>
                        <label for="name-filter" class="text-sm text-gray-600 mr-2">Name:</label>
                        <input id="name-filter" type="text" class="border border-gray-300 rounded px-2 py-1 text-sm">
                    </div>
                </div>
            </div>

            <!-- Company Recruitment Table -->
            <div class="company-table-container">
                <h3 class="text-lg font-semibold mb-4">Company Recruitment</h3>
                <div class="table-wrapper">
                    <table class="company-table" id="company-table">
                        <thead>
                            <tr>
                                <th data-sort="serial">Serial No <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="placement_interviews">Placement Interviews <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="internship_shortlists">Internship Shortlists <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="id">ID <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="name">Name <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="info">Info <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="company_category">Category <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="year">Year <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="published_at">Published At <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="createdAt">Created At <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="updatedAt">Updated At <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="event_id">Event ID <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="jobtitle">Job Title <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="category">Event Category <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="type">Type <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="degree">Degree <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="status">Status <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="optional_criteria">Optional Criteria <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="cgpa_10th">CGPA 10th <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="cgpa_12th">CGPA 12th <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="graduation_cgpa">Graduation CGPA <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="stipend">Stipend (INR) <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="stipend_info">Stipend Info <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="duration">Duration <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="campus">Campus <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="backlogs">Backlogs <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="branches_allowed">Branches Allowed <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="lastDate">Deadline <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="placeOfPosting">Location <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="degrees_allowed">Degrees <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                                <th data-sort="apc">POC <span class="sort-icon">↕</span><div class="resize-handle"></div></th>
                            </tr>
                        </thead>
                        <tbody id="company-table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Network Activity Log -->
            <div class="network-log" id="network-log-body"></div>

            <!-- Loading Indicator -->
            <div id="loading" class="text-center text-gray-500 mt-4 hidden">Loading...</div>

            <!-- Error Message -->
            <div id="error-message" class="text-center text-red-500 mt-4 hidden"></div>
        </div>
    </div>

    <script>
        // DOM Elements
        const fetchButton = document.getElementById('fetch-companies');
        const fetchLimit = document.getElementById('fetch-limit');
        const exportCsvButton = document.getElementById('export-csv');
        const tableBody = document.getElementById('company-table-body');
        const networkLogBody = document.getElementById('network-log-body');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const yearFilter = document.getElementById('year-filter');
        const typeFilter = document.getElementById('type-filter');
        const cgpaFilter = document.getElementById('cgpa-filter');
        const nameFilter = document.getElementById('name-filter');

        // State
        let companyData = [];
        let filteredData = [];
        let sortColumn = null;
        let sortDirection = 1; // 1 for ascending, -1 for descending

        // Bearer Token
        const bearerToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1Zjk1NTUxYzNkNWIzNzMwNzY5YWRiYSIsImlhdCI6MTc0Nzk3MzA5MywiZXhwIjoxNzUwNTY1MDkzfQ.oDgKeLGpRDz4w7zKWBUHS-trIyiJI2qp3GIs8qTBGsE";

        // Headers for API requests
        const headers = {
            "Authorization": `Bearer ${bearerToken}`,
            "connection": "keep-alive",
            "host": "api.tnpnsut.in",
            "origin": "https://admin.tnpnsut.in",
            "referer": "https://admin.tnpnsut.in/",
            "sec-ch-ua": '"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"macOS"',
            "sec-fetch-dest": "empty"
        };

        // Tag Colors
        const categoryColors = {
            'Dream': '#bfdbfe',
            'A++': '#fef9c3',
            'default': '#e5e7eb'
        };

        const yearColors = {
            '2023': '#ffedd5',
            '2024': '#d1fae5',
            '2025': '#bfdbfe',
            '2026': '#fce7f3'
        };

        function getCgpaColor(cgpa) {
            const value = parseFloat(cgpa);
            if (isNaN(value)) return '#e5e7eb';
            if (value < 6) return '#fee2e2';
            if (value <= 8) return '#fef9c3';
            return '#d1fae5';
        }

        // Fetch list of companies
        async function fetchCompaniesList() {
            const url = 'https://api.tnpnsut.in/companies';
            const startTime = performance.now();
            try {
                const response = await fetch(url, { headers });
                const endTime = performance.now();
                const size = response.headers.get('content-length') || 'Unknown';
                logNetworkActivity(url, response.status, size, endTime - startTime, 'fetch');
                
                if (response.ok) {
                    let companies = await response.json();
                    const limit = fetchLimit.value;
                    if (limit !== 'all') {
                        companies = companies.slice(0, parseInt(limit));
                    }
                    return companies;
                } else {
                    throw new Error(`Failed to fetch companies list - Status: ${response.status}`);
                }
            } catch (error) {
                logNetworkActivity(url, 'Failed', '0', performance.now() - startTime, 'fetch');
                throw error;
            }
        }

        // Fetch company details
        async function fetchCompanyDetails(companyId) {
            const url = `https://api.tnpnsut.in/companies/${companyId}`;
            const startTime = performance.now();
            try {
                const response = await fetch(url, { headers });
                const endTime = performance.now();
                const size = response.headers.get('content-length') || 'Unknown';
                logNetworkActivity(url, response.status, size, endTime - startTime, 'fetch');
                
                if (response.ok) {
                    const data = await response.json();
                    console.log(`API Response for ${companyId}:`, data);
                    return data;
                } else {
                    throw new Error(`Failed to fetch data for company ID ${companyId} - Status: ${response.status}`);
                }
            } catch (error) {
                logNetworkActivity(url, 'Failed', '0', performance.now() - startTime, 'fetch');
                throw error;
            }
        }

        // Log network activity
        function logNetworkActivity(name, status, size, time, type) {
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `Request: ${name} | <span class="status">Status: ${status}</span> | Size: ${size} bytes | <span class="time">Time: ${time.toFixed(2)} ms</span> | Type: ${type}`;
            networkLogBody.appendChild(logEntry);
        }

        // Fetch all company data
        async function fetchAllCompanies() {
            loading.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            networkLogBody.innerHTML = '';
            companyData = [];
            filteredData = [];
            exportCsvButton.classList.add('hidden');

            try {
                const companies = await fetchCompaniesList();
                if (!Array.isArray(companies) || companies.length === 0) {
                    throw new Error('No companies found in the API response.');
                }

                for (const company of companies) {
                    try {
                        const details = await fetchCompanyDetails(company.id);
                        companyData.push({ id: company.id, name: company.name, details });
                        await new Promise(resolve => setTimeout(resolve, 100));
                    } catch (error) {
                        console.error(error.message);
                    }
                }

                if (companyData.length === 0) {
                    throw new Error('No company details fetched. Please check the API or token.');
                }

                filteredData = [...companyData];
                applyFilters();
                exportCsvButton.classList.remove('hidden');
            } catch (error) {
                showError(error.message);
            } finally {
                loading.classList.add('hidden');
            }
        }

        // Apply filters
        function applyFilters() {
            const year = yearFilter.value;
            const type = typeFilter.value.toLowerCase();
            const cgpa = parseFloat(cgpaFilter.value) || null;
            const name = nameFilter.value.toLowerCase();

            filteredData = companyData.filter(company => {
                const details = company.details || {};
                const event = details.events && details.events.length > 0 ? details.events[0] : {};
                const matchesYear = year ? details.year === year : true;
                const matchesType = type ? (event.type || '').toLowerCase().includes(type) : true;
                const matchesCgpa = cgpa !== null ? (event.graduation_cgpa || 0) >= cgpa : true;
                const matchesName = name ? (details.Name || company.name || '').toLowerCase().includes(name) : true;
                return matchesYear && matchesType && matchesCgpa && matchesName;
            });

            sortData();
            renderTable();
        }

        // Sort data
        function sortData() {
            if (!sortColumn) return;

            filteredData.sort((a, b) => {
                const detailsA = a.details || {};
                const detailsB = b.details || {};
                const eventA = detailsA.events && detailsA.events.length > 0 ? detailsA.events[0] : {};
                const eventB = detailsB.events && detailsB.events.length > 0 ? detailsB.events[0] : {};
                let valueA, valueB;

                if (sortColumn === 'serial') {
                    valueA = companyData.indexOf(a);
                    valueB = companyData.indexOf(b);
                } else if (sortColumn === 'placement_interviews') {
                    valueA = (detailsA.placement_interviews || []).length;
                    valueB = (detailsB.placement_interviews || []).length;
                } else if (sortColumn === 'internship_shortlists') {
                    valueA = (detailsA.internship_shortlists || []).length;
                    valueB = (detailsB.internship_shortlists || []).length;
                } else if (sortColumn === 'name') {
                    valueA = (detailsA.Name || a.name || '').toLowerCase();
                    valueB = (detailsB.Name || b.name || '').toLowerCase();
                } else if (sortColumn === 'graduation_cgpa' || sortColumn === 'cgpa_10th' || sortColumn === 'cgpa_12th' || sortColumn === 'stipend' || sortColumn === 'backlogs') {
                    valueA = parseFloat(eventA[sortColumn]) || 0;
                    valueB = parseFloat(eventB[sortColumn]) || 0;
                } else if (sortColumn === 'event_id') {
                    valueA = (eventA._id || '').toLowerCase();
                    valueB = (eventB._id || '').toLowerCase();
                } else if (sortColumn === 'degrees_allowed' || sortColumn === 'campus' || sortColumn === 'branches_allowed') {
                    valueA = (eventA[sortColumn] || []).join(', ').toLowerCase();
                    valueB = (eventB[sortColumn] || []).join(', ').toLowerCase();
                } else {
                    valueA = (eventA[sortColumn] || detailsA[sortColumn] || '').toString().toLowerCase();
                    valueB = (eventB[sortColumn] || detailsB[sortColumn] || '').toString().toLowerCase();
                }

                if (valueA < valueB) return -1 * sortDirection;
                if (valueA > valueB) return 1 * sortDirection;
                return 0;
            });
        }

        // Render the table
        function renderTable() {
            tableBody.innerHTML = '';
            filteredData.forEach((company, index) => {
                const details = company.details || {};
                const event = details.events && details.events.length > 0 ? details.events[0] : {};
                const branchesAllowed = (event.branchesAllowed || []).map(b => b.branch).join(', ');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${details.placement_interviews && details.placement_interviews.length > 0 ? details.placement_interviews.length : 'None'}</td>
                    <td>${details.internship_shortlists && details.internship_shortlists.length > 0 ? details.internship_shortlists.length : 'None'}</td>
                    <td>${details._id || '-'}</td>
                    <td>${details.Name || company.name || '-'}</td>
                    <td>${details.info || '-'}</td>
                    <td><span class="tag" style="background-color: ${categoryColors[details.company_category] || categoryColors.default}">${details.company_category || '-'}</span></td>
                    <td><span class="tag" style="background-color: ${yearColors[details.year] || '#e5e7eb'}">${details.year || '-'}</span></td>
                    <td>${details.published_at || '-'}</td>
                    <td>${details.createdAt || '-'}</td>
                    <td>${details.updatedAt || '-'}</td>
                    <td>${event._id || '-'}</td>
                    <td>${event.jobtitle || '-'}</td>
                    <td>${event.category || '-'}</td>
                    <td>${event.type || '-'}</td>
                    <td>${event.degree || '-'}</td>
                    <td>${event.status || '-'}</td>
                    <td>${event.optional_criteria !== undefined ? event.optional_criteria : '-'}</td>
                    <td>${event.cgpa_10th !== undefined ? event.cgpa_10th : '-'}</td>
                    <td>${event.cgpa_12th !== undefined ? event.cgpa_12th : '-'}</td>
                    <td><span class="tag" style="background-color: ${getCgpaColor(event.graduation_cgpa)}">${event.graduation_cgpa !== undefined ? event.graduation_cgpa : '-'}</span></td>
                    <td>${event.stipend !== undefined ? event.stipend : '-'}</td>
                    <td>${event.stipend_info || '-'}</td>
                    <td>${event.duration || '-'}</td>
                    <td>${(event.campus || []).join(', ') || '-'}</td>
                    <td>${event.backlogs !== undefined ? event.backlogs : '-'}</td>
                    <td>${branchesAllowed || '-'}</td>
                    <td>${event.lastDate || '-'}</td>
                    <td>${event.placeOfPosting || '-'}</td>
                    <td>${(event.degrees_allowed || []).join(', ') || '-'}</td>
                    <td>${event.apc || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Export to CSV
        function exportToCsv() {
            const headers = [
                'Serial No', 'Placement Interviews', 'Internship Shortlists', 'ID', 'Name', 'Info', 'Category', 
                'Year', 'Published At', 'Created At', 'Updated At', 'Event ID', 'Job Title', 'Event Category', 
                'Type', 'Degree', 'Status', 'Optional Criteria', 'CGPA 10th', 'CGPA 12th', 'Graduation CGPA', 
                'Stipend (INR)', 'Stipend Info', 'Duration', 'Campus', 'Backlogs', 'Branches Allowed', 'Deadline', 
                'Location', 'Degrees', 'POC'
            ];
            const rows = filteredData.map((company, index) => {
                const details = company.details || {};
                const event = details.events && details.events.length > 0 ? details.events[0] : {};
                const branchesAllowed = (event.branchesAllowed || []).map(b => b.branch).join(', ');
                return [
                    index + 1,
                    details.placement_interviews && details.placement_interviews.length > 0 ? details.placement_interviews.length : 'None',
                    details.internship_shortlists && details.internship_shortlists.length > 0 ? details.internship_shortlists.length : 'None',
                    details._id || '-',
                    `"${(details.Name || company.name || '-').replace(/"/g, '""')}"`,
                    `"${(details.info || '-').replace(/"/g, '""')}"`,
                    details.company_category || '-',
                    details.year || '-',
                    details.published_at || '-',
                    details.createdAt || '-',
                    details.updatedAt || '-',
                    event._id || '-',
                    `"${(event.jobtitle || '-').replace(/"/g, '""')}"`,
                    event.category || '-',
                    event.type || '-',
                    event.degree || '-',
                    event.status || '-',
                    event.optional_criteria !== undefined ? event.optional_criteria : '-',
                    event.cgpa_10th !== undefined ? event.cgpa_10th : '-',
                    event.cgpa_12th !== undefined ? event.cgpa_12th : '-',
                    event.graduation_cgpa !== undefined ? event.graduation_cgpa : '-',
                    event.stipend !== undefined ? event.stipend : '-',
                    `"${(event.stipend_info || '-').replace(/"/g, '""')}"`,
                    `"${(event.duration || '-').replace(/"/g, '""')}"`,
                    (event.campus || []).join(', ') || '-',
                    event.backlogs !== undefined ? event.backlogs : '-',
                    branchesAllowed || '-',
                    event.lastDate || '-',
                    event.placeOfPosting || '-',
                    (event.degrees_allowed || []).join(', ') || '-',
                    `"${(event.apc || '-').replace(/"/g, '""')}"`
                ];
            });

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'company_data.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            loading.classList.add('hidden');
        }

        // Column resizing
        document.querySelectorAll('.resize-handle').forEach(handle => {
            handle.addEventListener('mousedown', (e) => {
                const th = handle.parentElement;
                const startX = e.pageX;
                const startWidth = th.offsetWidth;

                const onMouseMove = (e) => {
                    const newWidth = startWidth + (e.pageX - startX);
                    th.style.width = `${Math.max(80, newWidth)}px`;
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        });

        // Event Listeners
        fetchButton.addEventListener('click', fetchAllCompanies);
        exportCsvButton.addEventListener('click', exportToCsv);

        // Filter event listeners
        yearFilter.addEventListener('change', applyFilters);
        typeFilter.addEventListener('input', applyFilters);
        cgpaFilter.addEventListener('input', applyFilters);
        nameFilter.addEventListener('input', applyFilters);

        // Sort event listeners
        document.querySelectorAll('th[data-sort]').forEach(header => {
            header.addEventListener('click', () => {
                const column = header.dataset.sort;
                if (sortColumn === column) {
                    sortDirection *= -1;
                } else {
                    sortColumn = column;
                    sortDirection = 1;
                }
                document.querySelectorAll('.sort-icon').forEach(icon => {
                    icon.textContent = '↕';
                });
                const icon = header.querySelector('.sort-icon');
                icon.textContent = sortDirection === 1 ? '↑' : '↓';
                sortData();
                renderTable();
            });
        });
    </script>
</body>
</html>
