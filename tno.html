<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Data Fetcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.10/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div id="root"></div>

    <script type="text/babel">
        function App() {
            const [students, setStudents] = React.useState([]);
            const [isFetching, setIsFetching] = React.useState(false);
            const [progress, setProgress] = React.useState(0);
            const [log, setLog] = React.useState('');
            const [isPaused, setIsPaused] = React.useState(false);

            const batches = ['2024', '2025', '2026', '2027', '2028'];
            const token = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1Zjk1NTUxYzNkNWIzNzMwNzY5YWRiYSIsImlhdCI6MTc1MDg3NTg3NywiZXhwIjoxNzUzNDY3ODc3fQ.RRvoUFo76Q65vECK3P8cIHy7MSgGTd8zkmYYaqE89Dw';

            const fetchStudents = async () => {
                setIsFetching(true);
                setIsPaused(false);
                setStudents([]);
                setLog('');
                setProgress(0);

                let allStudents = [];
                const totalBatches = batches.length;

                for (let i = 0; i < totalBatches; i++) {
                    if (!isFetching) break; // Stop if paused
                    const batch = batches[i];
                    try {
                        const response = await fetch(`https://api.tnpnsut.in/students?batch=${batch}&_limit=20000&_sort=rollNumber`, {
                            headers: { Authorization: token }
                        });
                        const data = await response.json();
                        allStudents = [...allStudents, ...data];
                        setStudents(allStudents);
                        setLog(`Fetched ${data.length} students from batch ${batch}. Total: ${allStudents.length}`);
                        setProgress(((i + 1) / totalBatches) * 100);
                    } catch (error) {
                        setLog(`Error fetching batch ${batch}: ${error.message}`);
                    }
                }

                setIsFetching(false);
            };

            const pauseFetch = () => {
                setIsFetching(false);
                setIsPaused(true);
                setLog(`Paused. Total students fetched: ${students.length}`);
            };

            const exportToJSON = () => {
                const json = JSON.stringify(students, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'students_data.json';
                a.click();
                URL.revokeObjectURL(url);
            };

            const exportToCSV = () => {
                // Flatten nested objects for CSV
                const flattenedStudents = students.map(student => {
                    const flatStudent = { ...student };
                    if (student.resume && student.resume.length > 0) {
                        flatStudent.resume_url = student.resume[0].url;
                        flatStudent.resume_name = student.resume[0].name;
                    }
                    if (student.user) {
                        flatStudent.user_email = student.user.email;
                        flatStudent.user_username = student.user.username;
                    }
                    delete flatStudent.resume;
                    delete flatStudent.user;
                    return flatStudent;
                });

                const csv = Papa.unparse(flattenedStudents);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'students_data.csv';
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
                    <h1 className="text-2xl font-bold mb-4">Student Data Fetcher</h1>
                    <div className="flex space PODCAST

System: I'm sorry, it looks like your message was cut off at "PODCAST". Based on the context, it seems you were about to mention something related to the web app, possibly additional features or requirements. Since the message is incomplete, I'll proceed with creating the web app based on the provided requirements, assuming no additional instructions were intended. If you meant to include more details, please clarify, and I can update the artifact accordingly.

The web app below fetches student data from the specified API endpoints for batches 2024-2028, displays a progress bar, logs the number of students fetched, and provides buttons to export the data to JSON and CSV files. The export buttons are visible when fetching is paused or complete, and all API response parameters are included in the exports.

<xaiArtifact artifact_id="614e8ff3-7953-4acb-8028-bdc03f3d49ce" artifact_version_id="50226225-260b-4597-b849-aafe3f7b5321" title="index.html" contentType="text/html">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Data Fetcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.10/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body className="bg-gray-100 p-6">
    <div id="root"></div>

    <script type="text/babel">
        function App() {
            const [students, setStudents] = React.useState([]);
            const [isFetching, setIsFetching] = React.useState(false);
            const [progress, setProgress] = React.useState(0);
            const [log, setLog] = React.useState('');
            const [isPaused, setIsPaused] = React.useState(false);

            const batches = ['2024', '2025', '2026', '2027', '2028'];
            const token = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1Zjk1NTUxYzNkNWIzNzMwNzY5YWRiYSIsImlhdCI6MTc1MDg3NTg3NywiZXhwIjoxNzUzNDY3ODc3fQ.RRvoUFo76Q65vECK3P8cIHy7MSgGTd8zkmYYaqE89Dw';

            const fetchStudents = async () => {
                setIsFetching(true);
                setIsPaused(false);
                setStudents([]);
                setLog('');
                setProgress(0);

                let allStudents = [];
                const totalBatches = batches.length;

                for (let i = 0; i < totalBatches; i++) {
                    if (!isFetching) break; // Stop if paused
                    const batch = batches[i];
                    try {
                        const response = await fetch(`https://api.tnpnsut.in/students?batch=${batch}&_limit=20000&_sort=rollNumber`, {
                            headers: { Authorization: token }
                        });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const data = await response.json();
                        allStudents = [...allStudents, ...data];
                        setStudents(allStudents);
                        setLog(`Fetched ${data.length} students from batch ${batch}. Total: ${allStudents.length}`);
                        setProgress(((i + 1) / totalBatches) * 100);
                    } catch (error) {
                        setLog(`Error fetching batch ${batch}: ${error.message}`);
                    }
                }

                setIsFetching(false);
                if (!isPaused) {
                    setLog(`Completed. Total students fetched: ${allStudents.length}`);
                }
            };

            const pauseFetch = () => {
                setIsFetching(false);
                setIsPaused(true);
                setLog(`Paused. Total students fetched: ${students.length}`);
            };

            const exportToJSON = () => {
                const json = JSON.stringify(students, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'students_data.json';
                a.click();
                URL.revokeObjectURL(url);
            };

            const exportToCSV = () => {
                const flattenedStudents = students.map(student => {
                    const flatStudent = { ...student };
                    if (student.resume && student.resume.length > 0) {
                        flatStudent.resume_url = student.resume[0].url || '';
                        flatStudent.resume_name = student.resume[0].name || '';
                        flatStudent.resume_id = student.resume[0]._id || '';
                        flatStudent.resume_hash = student.resume[0].hash || '';
                        flatStudent.resume_ext = student.resume[0].ext || '';
                        flatStudent.resume_mime = student.resume[0].mime || '';
                        flatStudent.resume_size = student.resume[0].size || '';
                        flatStudent.resume_provider = student.resume[0].provider || '';
                        flatStudent.resume_createdAt = student.resume[0].createdAt || '';
                        flatStudent.resume_updatedAt = student.resume[0].updatedAt || '';
                    }
                    if (student.user) {
                        flatStudent.user_id = student.user._id || '';
                        flatStudent.user_email = student.user.email || '';
                        flatStudent.user_username = student.user.username || '';
                        flatStudent.user_provider = student.user.provider || '';
                        flatStudent.user_createdAt = student.user.createdAt || '';
                        flatStudent.user_updatedAt = student.user.updatedAt || '';
                        flatStudent.user_role = student.user.role || '';
                        flatStudent.user_student = student.user.student || '';
                        flatStudent.user_confirmed = student.user.confirmed || '';
                        flatStudent.user_blocked = student.user.blocked || '';
                    }
                    flatStudent.intern_applied = student.intern_applied ? student.intern_applied.join(',') : '';
                    flatStudent.placement_applied = student.placement_applied ? student.placement_applied.join(',') : '';
                    delete flatStudent.resume;
                    delete flatStudent.user;
                    return flatStudent;
                });

                const csv = Papa.unparse(flattenedStudents);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'students_data.csv';
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
                    <h1 className="text-2xl font-bold mb-4">Student Data Fetcher</h1>
                    <div className="flex space-x-4 mb-4">
                        <button
                            onClick={fetchStudents}
                            disabled={isFetching}
                            className={`px-4 py-2 rounded text-white ${isFetching ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'}`}
                        >
                            Fetch All
                        </button>
                        {isFetching && (
                            <button
                                onClick={pauseFetch}
                                className="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded"
                            >
                                Pause
                            </button>
                        )}
                        {(isPaused || (!isFetching && students.length > 0)) && (
                            <>
                                <button
                                    onClick={exportToJSON}
                                    className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded"
                                >
                                    Export to JSON
                                </button>
                                <button
                                    onClick={exportToCSV}
                                    className="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded"
                                >
                                    Export to CSV
                                </button>
                            </>
                        )}
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-4 mb-4">
                        <div
                            className="bg-blue-500 h-4 rounded-full"
                            style={{ width: `${progress}%` }}
                        ></div>
                    </div>
                    <div className="bg-gray-100 p-4 rounded h-40 overflow-y-auto">
                        <pre>{log}</pre>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>