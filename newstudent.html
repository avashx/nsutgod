<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSUTGod</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        .table-row {
            height: 48px; /* Matches typical row height in index.html */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">NSUTGod</h1>
            <nav>
                <a href="#overview" class="px-2 py-1 text-gray-700 hover:text-blue-500">Overview</a>
                <a href="#student-profile" class="px-2 py-1 text-gray-700 hover:text-blue-500">Student Profile</a>
                <a href="#analytics" class="px-2 py-1 text-gray-700 hover:text-blue-500">Analytics</a>
                <a href="#placement" class="px-2 py-1 text-gray-700 hover:text-blue-500">Placement</a>
                <a href="#notifications" class="px-2 py-1 text-gray-700 hover:text-blue-500">Notifications <span class="bg-red-500 text-white rounded-full px-2">2</span></a>
            </nav>
        </header>

        <div id="overview" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Student Data - NSUTGod</h2>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div>
                    <button id="fetchAllBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch All</button>
                    <button id="fetch100Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 100</button>
                    <button id="fetch300Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 300</button>
                    <button id="fetch500Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 500</button>
                    <button id="fetch1000Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 1000</button>
                    <button id="exportJsonBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Export to JSON</button>
                    <button id="pauseBtn" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Pause</button>
                </div>
                <div class="flex flex-wrap gap-2">
                    <div>
                        <label for="batchFilter">Batch Year:</label>
                        <select id="batchFilter" class="border rounded px-2 py-1">
                            <option value="All">All</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                    <div>
                        <label for="genderFilter">Filter by Gender:</label>
                        <select id="genderFilter" class="border rounded px-2 py-1">
                            <option value="All">All</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="cgpaFilter">CGPA:</label>
                        <input id="cgpaFilter" type="text" class="border rounded px-2 py-1" placeholder="CGPA">
                    </div>
                    <div>
                        <label for="nameFilter">Name:</label>
                        <input id="nameFilter" type="text" class="border rounded px-2 py-1" placeholder="Name">
                    </div>
                </div>
                <div>
                    <label for="rowsPerPage">Rows per page:</label>
                    <select id="rowsPerPage" class="border rounded px-2 py-1">
                        <option value="150">150</option>
                        <option value="300">300</option>
                        <option value="500">500</option>
                        <option value="All">All</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold">Network Activity Log</h3>
                <div id="networkLog" class="text-sm text-gray-600"></div>
            </div>

            <div class="mb-4">
                <p>Fetching Students...</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="fetchCount" class="text-sm text-gray-600">0 students fetched</p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold">Customize Columns</h3>
                <div id="customizeColumns" class="flex flex-wrap gap-2">
                    <!-- Column customization can be implemented later -->
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border">
                    <thead>
                        <tr>
                            <th class="px-4 py-2 border">
                                Serial No
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('serialNo', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('serialNo', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('serialNo')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('serialNo')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Roll Number
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('rollNumber', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('rollNumber', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('rollNumber')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('rollNumber')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Name
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('name', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('name', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('name')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('name')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Branch
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('branch', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('branch', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('branch')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('branch')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Email
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('email', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('email', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('email')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('email')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Gender
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('gender', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('gender', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('gender')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('gender')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                DOB
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('dob', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('dob', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('dob')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('dob')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Contact Number
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('contact_number', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('contact_number', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('contact_number')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('contact_number')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Present Address
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('present_address', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('present_address', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('present_address')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('present_address')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                Category
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('category', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('category', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('category')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('category')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                CGPA
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('cgpa', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('cgpa', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('cgpa')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('cgpa')">Apply</button>
                                    </div>
                                </div>
                            </th>
                            <th class="px-4 py-2 border">
                                View Profile
                                <div class="dropdown relative inline-block">
                                    <button class="text-gray-500">...</button>
                                    <div class="dropdown-menu hidden absolute bg-white shadow-md rounded mt-2">
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('viewProfile', 'asc')">Sort Ascending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="sortTable('viewProfile', 'desc')">Sort Descending</a>
                                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="filterColumn('viewProfile')">Filter</a>
                                        <button class="block px-4 py-2 text-sm hover:bg-gray-100" onclick="applyFilter('viewProfile')">Apply</button>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody"></tbody>
                </table>
                <div class="flex justify-between mt-4">
                    <button id="prevPageBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" disabled>Previous</button>
                    <span id="pageInfo">Page 1</span>
                    <button id="nextPageBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" disabled>Next</button>
                </div>
            </div>
        </div>

        <div id="student-profile" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Student Profile</h2>
            <p>This section will allow viewing individual student profiles. (Placeholder)</p>
        </div>

        <div id="analytics" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Analytics</h2>
            <p>This section will display analytics graphs. See analytics.html for details.</p>
        </div>

        <div id="placement" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Placement</h2>
            <p>This section will display placement statistics. See placement.html for details.</p>
        </div>

        <div id="notifications" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Notifications</h2>
            <p>This section will display notifications. (Placeholder)</p>
        </div>
    </div>

    <script>
        let students = [];
        let currentPage = 1;
        let rowsPerPage = 150;
        let isPaused = false;
        let filters = {};

        async function fetchStudents(limit, batch = 'All', gender = 'All') {
            if (isPaused) return;
            const token = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1Zjk1NTUxYzNkNWIzNzMwNzY5YWRiYSIsImlhdCI6MTc1MDg3NTg3NywiZXhwIjoxNzUzNDY3ODc3fQ.RRvoUFo76Q65vECK3P8cIHy7MSgGTd8zkmYYaqE89Dw';
            let url = `https://api.tnpnsut.in/students?_limit=${limit}&_sort=rollNumber`;
            if (batch !== 'All') {
                url += `&batch=${batch}`;
            }
            if (gender !== 'All') {
                url += `&gender=${gender}`;
            }

            try {
                const response = await fetch(url, {
                    headers: { 'Authorization': token }
                });
                const data = await response.json();
                // Ensure data is an array
                students = Array.isArray(data) ? data : data.data || [];
                logNetworkActivity(`Fetched ${students.length} students`);
                updateFetchCount(students.length);
                updateProgressBar(students.length, limit);
                applyFilters();
            } catch (error) {
                logNetworkActivity(`Error fetching students: ${error.message}`);
            }
        }

        function logNetworkActivity(message) {
            const logDiv = document.getElementById('networkLog');
            logDiv.innerHTML += `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
        }

        function updateFetchCount(count) {
            document.getElementById('fetchCount').textContent = `${count} students fetched`;
        }

        function updateProgressBar(fetched, total) {
            const percentage = Math.min((fetched / total) * 100, 100);
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        function applyFilters() {
            let filteredStudents = [...students];
            if (filters.name) {
                filteredStudents = filteredStudents.filter(student => 
                    (student.name || student.Name || '').toLowerCase().includes(filters.name.toLowerCase()));
            }
            if (filters.cgpa) {
                filteredStudents = filteredStudents.filter(student => 
                    student.cgpa && student.cgpa >= parseFloat(filters.cgpa));
            }
            displayStudents(filteredStudents);
        }

        function displayStudents(filteredStudents = students) {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            const start = (currentPage - 1) * (rowsPerPage === 'All' ? filteredStudents.length : rowsPerPage);
            const end = rowsPerPage === 'All' ? filteredStudents.length : start + parseInt(rowsPerPage);
            const paginatedStudents = filteredStudents.slice(start, end);

            paginatedStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="px-4 py-2 border">${start + index + 1}</td>
                    <td class="px-4 py-2 border">${student.rollNumber || '-'}</td>
                    <td class="px-4 py-2 border">${student.name || student.Name || '-'}</td>
                    <td class="px-4 py-2 border">${student.branch || '-'}</td>
                    <td class="px-4 py-2 border">${student.email || '-'}</td>
                    <td class="px-4 py-2 border">${student.gender || '-'}</td>
                    <td class="px-4 py-2 border">${student.dob || '-'}</td>
                    <td class="px-4 py-2 border">${student.contact_number || '-'}</td>
                    <td class="px-4 py-2 border">${student.present_address || '-'}</td>
                    <td class="px-4 py-2 border">${student.category || '-'}</td>
                    <td class="px-4 py-2 border">${student.cgpa || '-'}</td>
                    <td class="px-4 py-2 border"><a href="student-profile.html?id=${student.id}" class="text-blue-500 hover:underline">View Profile</a></td>
                `;
                tbody.appendChild(row);
            });

            updatePagination(filteredStudents.length);
        }

        function updatePagination(totalStudents) {
            const totalPages = rowsPerPage === 'All' ? 1 : Math.ceil(totalStudents / rowsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
        }

        function exportToJson() {
            const dataStr = JSON.stringify(students, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'students.json';
            a.click();
            URL.revokeObjectURL(url);
            logNetworkActivity('Exported student data to JSON');
        }

        function sortTable(column, direction) {
            students.sort((a, b) => {
                const valA = a[column] || (column === 'name' ? a.Name : '');
                const valB = b[column] || (column === 'name' ? b.Name : '');
                if (direction === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });
            applyFilters();
            logNetworkActivity(`Sorted by ${column} ${direction}`);
        }

        function filterColumn(column) {
            const value = prompt(`Enter filter value for ${column}:`);
            if (value !== null) {
                filters[column] = value;
                applyFilters();
                logNetworkActivity(`Filtered ${column} by ${value}`);
            }
        }

        function applyFilter(column) {
            applyFilters();
        }

        // Event Listeners
        document.getElementById('fetchAllBtn').addEventListener('click', () => fetchStudents(16000));
        document.getElementById('fetch100Btn').addEventListener('click', () => fetchStudents(100));
        document.getElementById('fetch300Btn').addEventListener('click', () => fetchStudents(300));
        document.getElementById('fetch500Btn').addEventListener('click', () => fetchStudents(500));
        document.getElementById('fetch1000Btn').addEventListener('click', () => fetchStudents(1000));
        document.getElementById('exportJsonBtn').addEventListener('click', exportToJson);
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? 'Resume' : 'Pause';
            logNetworkActivity(isPaused ? 'Paused fetching' : 'Resumed fetching');
        });
        document.getElementById('batchFilter').addEventListener('change', (e) => {
            fetchStudents(rowsPerPage === 'All' ? 16000 : rowsPerPage, e.target.value, document.getElementById('genderFilter').value);
        });
        document.getElementById('genderFilter').addEventListener('change', (e) => {
            fetchStudents(rowsPerPage === 'All' ? 16000 : rowsPerPage, document.getElementById('batchFilter').value, e.target.value);
        });
        document.getElementById('rowsPerPage').addEventListener('change', (e) => {
            rowsPerPage = e.target.value;
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('prevPageBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                applyFilters();
            }
        });
        document.getElementById('nextPageBtn').addEventListener('click', () => {
            const totalPages = rowsPerPage === 'All' ? 1 : Math.ceil(students.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                applyFilters();
            }
        });
        document.getElementById('nameFilter').addEventListener('input', (e) => {
            filters.name = e.target.value;
            applyFilters();
        });
        document.getElementById('cgpaFilter').addEventListener('input', (e) => {
            filters.cgpa = e.target.value;
            applyFilters();
        });

        // Initialize dropdowns
        document.querySelectorAll('.dropdown').forEach(dropdown => {
            dropdown.addEventListener('mouseenter', () => {
                dropdown.querySelector('.dropdown-menu').classList.remove('hidden');
            });
            dropdown.addEventListener('mouseleave', () => {
                dropdown.querySelector('.dropdown-menu').classList.add('hidden');
            });
        });

        // Initial fetch
        fetchStudents(150);
    </script>
</body>
</html>