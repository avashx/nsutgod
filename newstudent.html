<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSUTGod</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">NSUTGod</h1>
            <nav>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500">Overview</a>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500 font-bold">Student Profile</a>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500">Analytics</a>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500">Placement</a>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500">TnP</a>
                <a href="#" class="px-2 py-1 text-gray-700 hover:text-blue-500">Notifications <span class="bg-red-500 text-white rounded-full px-2">2</span></a>
            </nav>
        </header>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">NSUTGod API Student Fetch</h2>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div>
                    <button id="fetchAllBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch All</button>
                    <button id="fetch100Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 100</button>
                    <button id="fetch300Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 300</button>
                    <button id="fetch500Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 500</button>
                    <button id="fetch1000Btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Fetch 1000</button>
                    <button id="exportJsonBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Export to JSON</button>
                    <button id="pauseBtn" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Pause</button>
                </div>
                <div>
                    <label for="batchFilter">Year:</label>
                    <select id="batchFilter" class="border rounded px-2 py-1">
                        <option value="All">All</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                    </select>
                    <label for="typeFilter">Type:</label>
                    <input id="typeFilter" type="text" class="border rounded px-2 py-1" placeholder="Type">
                    <label for="cgpaFilter">CGPA:</label>
                    <input id="cgpaFilter" type="text" class="border rounded px-2 py-1" placeholder="CGPA">
                    <label for="nameFilter">Name:</label>
                    <input id="nameFilter" type="text" class="border rounded px-2 py-1" placeholder="Name">
                </div>
                <div>
                    <label for="rowsPerPage">Show Rows per page:</label>
                    <select id="rowsPerPage" class="border rounded px-2 py-1">
                        <option value="100">100</option>
                        <option value="300">300</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <p>Fetching Students...</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="fetchCount" class="text-sm text-gray-600">0 students fetched</p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold">Network Activity Log</h3>
                <div id="networkLog" class="text-sm text-gray-600"></div>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border">
                    <thead>
                        <tr>
                            <th class="px-4 py-2 border">Sno.</th>
                            <th class="px-4 py-2 border">Roll Number ↕</th>
                            <th class="px-4 py-2 border">Name ↕</th>
                            <th class="px-4 py-2 border">Branch ↕</th>
                            <th class="px-4 py-2 border">Email ↕</th>
                            <th class="px-4 py-2 border">Gender ↕</th>
                            <th class="px-4 py-2 border">DOB ↕</th>
                            <th class="px-4 py-2 border">Contact Number ↕</th>
                            <th class="px-4 py-2 border">Present Address ↕</th>
                            <th class="px-4 py-2 border">Category ↕</th>
                            <th class="px-4 py-2 border">CGPA ↕</th>
                            <th class="px-4 py-2 border">View</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody"></tbody>
                </table>
                <div class="flex justify-between mt-4">
                    <button id="prevPageBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" disabled>Previous</button>
                    <span id="pageInfo">Page 1</span>
                    <button id="nextPageBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" disabled>Next</button>
                </div>
            </div>

            <div class="mt-4">Loading...</div>
        </div>
    </div>

    <script>
        let students = [];
        let currentPage = 1;
        let rowsPerPage = 100;
        let isPaused = false;

        async function fetchStudents(limit, batch = 'All') {
            if (isPaused) return;
            const token = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1Zjk1NTUxYzNkNWIzNzMwNzY5YWRiYSIsImlhdCI6MTc1MDg3NTg3NywiZXhwIjoxNzUzNDY3ODc3fQ.RRvoUFo76Q65vECK3P8cIHy7MSgGTd8zkmYYaqE89Dw';
            let url = 'https://api.tnpnsut.in/students';
            if (batch !== 'All') {
                url = `https://api.tnpnsut.in/students?batch=${batch}&_limit=${limit}&_sort=rollNumber`;
            } else {
                url = `https://api.tnpnsut.in/students?_limit=${limit}&_sort=rollNumber`;
            }

            try {
                const response = await fetch(url, {
                    headers: { 'Authorization': token }
                });
                const data = await response.json();
                students = data;
                logNetworkActivity(`Fetched ${data.length} students`);
                updateFetchCount(data.length);
                updateProgressBar(data.length, limit);
                displayStudents();
            } catch (error) {
                logNetworkActivity(`Error fetching students: ${error.message}`);
            }
        }

        function logNetworkActivity(message) {
            const logDiv = document.getElementById('networkLog');
            logDiv.innerHTML += `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
        }

        function updateFetchCount(count) {
            document.getElementById('fetchCount').textContent = `${count} students fetched`;
        }

        function updateProgressBar(fetched, total) {
            const percentage = (fetched / total) * 100;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        function displayStudents() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedStudents = students.slice(start, end);

            paginatedStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 border">${start + index + 1}</td>
                    <td class="px-4 py-2 border">${student.rollNumber || '-'}</td>
                    <td class="px-4 py-2 border">${student.name || student.Name || '-'}</td>
                    <td class="px-4 py-2 border">${student.branch || '-'}</td>
                    <td class="px-4 py-2 border">${student.email || '-'}</td>
                    <td class="px-4 py-2 border">${student.gender || '-'}</td>
                    <td class="px-4 py-2 border">${student.dob || '-'}</td>
                    <td class="px-4 py-2 border">${student.contact_number || '-'}</td>
                    <td class="px-4 py-2 border">${student.present_address || '-'}</td>
                    <td class="px-4 py-2 border">${student.category || '-'}</td>
                    <td class="px-4 py-2 border">${student.cgpa || '-'}</td>
                    <td class="px-4 py-2 border"><a href="student-profiles.html?id=${student.id}" class="text-blue-500 hover:underline">View Profile</a></td>
                `;
                tbody.appendChild(row);
            });

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(students.length / rowsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
        }

        function exportToJson() {
            const dataStr = JSON.stringify(students, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'students.json';
            a.click();
            URL.revokeObjectURL(url);
            logNetworkActivity('Exported student data to JSON');
        }

        document.getElementById('fetchAllBtn').addEventListener('click', () => fetchStudents(40000));
        document.getElementById('fetch100Btn').addEventListener('click', () => fetchStudents(100));
        document.getElementById('fetch300Btn').addEventListener('click', () => fetchStudents(300));
        document.getElementById('fetch500Btn').addEventListener('click', () => fetchStudents(500));
        document.getElementById('fetch1000Btn').addEventListener('click', () => fetchStudents(1000));
        document.getElementById('exportJsonBtn').addEventListener('click', exportToJson);
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? 'Resume' : 'Pause';
            logNetworkActivity(isPaused ? 'Paused fetching' : 'Resumed fetching');
        });

        document.getElementById('batchFilter').addEventListener('change', (e) => fetchStudents(rowsPerPage, e.target.value));
        document.getElementById('rowsPerPage').addEventListener('change', (e) => {
            rowsPerPage = parseInt(e.target.value);
            currentPage = 1;
            displayStudents();
        });
        document.getElementById('prevPageBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayStudents();
            }
        });
        document.getElementById('nextPageBtn').addEventListener('click', () => {
            const totalPages = Math.ceil(students.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayStudents();
            }
        });

        // Initial fetch
        fetchStudents(100);
    </script>
</body>
</html>